"""
åˆ›æ„æ¿€å‘å·¥å…·

åŒ…å«å¤šç§æ€ç»´æ¿€åŠ±æŠ€æœ¯ï¼š
- SCAMPER: æ›¿ä»£ã€ç»„åˆã€è°ƒæ•´ã€ä¿®æ”¹ã€ç”¨é€”è½¬æ¢ã€æ¶ˆé™¤ã€é‡æ’
- å…­é¡¶æ€è€ƒå¸½: ä»ä¸åŒæ€ç»´è§’åº¦åˆ†æ
- éšæœºåˆºæ¿€æ³•: ç”¨éšæœºæ¦‚å¿µæ¿€å‘è”æƒ³
- é€†å‘æ€ç»´: ä»åé¢æ€è€ƒé—®é¢˜
"""
import random
from typing import Dict, List, Any


def apply_scamper(topic: str, context: str = "") -> Dict[str, Any]:
    """åº”ç”¨ SCAMPER åˆ›æ„æ–¹æ³•æ¿€å‘åˆ›æ–°æ€ç»´ã€‚
    
    SCAMPER æ˜¯ä¸€ç§ç³»ç»Ÿæ€§çš„åˆ›æ„æ¿€å‘æ–¹æ³•ï¼ŒåŒ…å«ä¸ƒä¸ªç»´åº¦ï¼š
    - Substitute (æ›¿ä»£): æœ‰ä»€ä¹ˆå¯ä»¥è¢«æ›¿ä»£ï¼Ÿ
    - Combine (ç»„åˆ): èƒ½å¦å°†å¤šä¸ªåŠŸèƒ½ç»„åˆï¼Ÿ
    - Adapt (è°ƒæ•´): èƒ½å¦å€Ÿé‰´å…¶ä»–é¢†åŸŸï¼Ÿ
    - Modify (ä¿®æ”¹): èƒ½å¦æ”¹å˜å±æ€§ï¼Ÿ
    - Put to other uses (ç”¨é€”è½¬æ¢): èƒ½å¦æ‰¾åˆ°æ–°åº”ç”¨ï¼Ÿ
    - Eliminate (æ¶ˆé™¤): èƒ½å¦ç®€åŒ–ï¼Ÿ
    - Rearrange (é‡æ’): èƒ½å¦æ”¹å˜ç»“æ„ï¼Ÿ
    
    Args:
        topic: è®¨è®ºä¸»é¢˜
        context: å½“å‰è®¨è®ºä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
        
    Returns:
        dict: åŒ…å«é€‰ä¸­çš„ SCAMPER ç»´åº¦å’Œåˆ›æ„æç¤º
    """
    scamper_prompts = {
        "S - Substitute (æ›¿ä»£)": "æœ‰ä»€ä¹ˆå¯ä»¥è¢«æ›¿ä»£ï¼Ÿææ–™ã€æµç¨‹ã€éƒ¨ä»¶ã€äººå‘˜ï¼Ÿ",
        "C - Combine (ç»„åˆ)": "èƒ½å¦å°†å¤šä¸ªåŠŸèƒ½ã€æƒ³æ³•æˆ–äº§å“ç»„åˆï¼Ÿè·¨ç•Œèåˆï¼Ÿ",
        "A - Adapt (è°ƒæ•´)": "èƒ½å¦å€Ÿé‰´å…¶ä»–é¢†åŸŸçš„æˆåŠŸç»éªŒï¼Ÿæ¨¡ä»¿è‡ªç„¶ç•Œï¼Ÿ",
        "M - Modify (ä¿®æ”¹)": "èƒ½å¦æ”¹å˜å¤§å°ã€å½¢çŠ¶ã€é¢œè‰²ã€é€Ÿåº¦æˆ–å…¶ä»–å±æ€§ï¼Ÿ",
        "P - Put to other uses (ç”¨é€”è½¬æ¢)": "èƒ½å¦æ‰¾åˆ°æ–°çš„åº”ç”¨åœºæ™¯ï¼ŸæœåŠ¡æ–°ç”¨æˆ·ï¼Ÿ",
        "E - Eliminate (æ¶ˆé™¤)": "èƒ½å¦ç®€åŒ–æˆ–å»é™¤æŸäº›éƒ¨åˆ†ï¼Ÿå‡å°‘æ­¥éª¤ï¼Ÿ",
        "R - Rearrange (é‡æ’)": "èƒ½å¦æ”¹å˜é¡ºåºã€å¸ƒå±€ã€æ—¶é—´å®‰æ’æˆ–ç»“æ„ï¼Ÿ"
    }
    
    # éšæœºé€‰æ‹© 2-3 ä¸ª SCAMPER ç»´åº¦
    num_dimensions = random.randint(2, 3)
    selected = random.sample(list(scamper_prompts.items()), k=num_dimensions)
    
    return {
        "technique": "SCAMPER",
        "description": "ç³»ç»Ÿæ€§åˆ›æ„æ¿€å‘æ–¹æ³•ï¼Œä»å¤šä¸ªç»´åº¦é‡æ–°æ€è€ƒé—®é¢˜",
        "topic": topic,
        "dimensions": [
            {"name": name, "prompt": prompt}
            for name, prompt in selected
        ],
        "instruction": f"è¯·é’ˆå¯¹ä¸»é¢˜ã€Œ{topic}ã€ï¼Œä»ä»¥ä¸‹ç»´åº¦è¿›è¡Œåˆ›æ–°æ€è€ƒï¼š\n" + 
                      "\n".join([f"â€¢ {name}: {prompt}" for name, prompt in selected])
    }


def apply_six_hats(topic: str) -> Dict[str, Any]:
    """åº”ç”¨å…­é¡¶æ€è€ƒå¸½æ–¹æ³•ï¼Œä»ä¸åŒè§’åº¦åˆ†æé—®é¢˜ã€‚
    
    å…­é¡¶æ€è€ƒå¸½æ˜¯çˆ±å¾·åÂ·å¾·Â·æ³¢è¯ºæå‡ºçš„å¹¶è¡Œæ€ç»´å·¥å…·ï¼Œ
    æ¯ç§é¢œè‰²çš„å¸½å­ä»£è¡¨ä¸€ç§æ€ç»´æ¨¡å¼ã€‚
    
    Args:
        topic: è®¨è®ºä¸»é¢˜
        
    Returns:
        dict: éšæœºåˆ†é…çš„æ€è€ƒå¸½å’Œå¯¹åº”æ€ç»´æ–¹å‘
    """
    hats = {
        "ç™½å¸½": {
            "emoji": "ğŸ“Š",
            "focus": "å®¢è§‚äº‹å®",
            "description": "å…³æ³¨æ•°æ®ã€ä¿¡æ¯å’Œäº‹å®ï¼Œä¸å¸¦æƒ…ç»ªåœ°åˆ†æï¼Œåªçœ‹è¯æ®",
            "questions": ["æœ‰å“ªäº›å·²çŸ¥äº‹å®ï¼Ÿ", "æˆ‘ä»¬éœ€è¦ä»€ä¹ˆä¿¡æ¯ï¼Ÿ", "æ•°æ®è¯´æ˜äº†ä»€ä¹ˆï¼Ÿ"]
        },
        "çº¢å¸½": {
            "emoji": "â¤ï¸",
            "focus": "æƒ…æ„Ÿç›´è§‰",
            "description": "å…³æ³¨æƒ…ç»ªã€æ„Ÿå—å’Œç›´è§‰ï¼Œä¸éœ€è¦è§£é‡Šç†ç”±",
            "questions": ["ä½ çš„ç›´è§‰å‘Šè¯‰ä½ ä»€ä¹ˆï¼Ÿ", "è¿™è®©ä½ æœ‰ä»€ä¹ˆæ„Ÿè§‰ï¼Ÿ", "ç¬¬ä¸€å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿ"]
        },
        "é»‘å¸½": {
            "emoji": "âš«",
            "focus": "è°¨æ…æ‰¹åˆ¤",
            "description": "å…³æ³¨é£é™©ã€é—®é¢˜å’Œéšœç¢ï¼Œæ‰¹åˆ¤æ€§æ€è€ƒï¼Œè¯†åˆ«å¼±ç‚¹",
            "questions": ["æœ‰ä»€ä¹ˆé£é™©ï¼Ÿ", "å¯èƒ½å‡ºä»€ä¹ˆé—®é¢˜ï¼Ÿ", "æœ‰å“ªäº›éšœç¢ï¼Ÿ"]
        },
        "é»„å¸½": {
            "emoji": "ğŸ’›",
            "focus": "ä¹è§‚ç§¯æ",
            "description": "å…³æ³¨ä»·å€¼ã€å¥½å¤„å’Œæœºä¼šï¼Œç§¯ææ­£é¢æ€è€ƒï¼Œå¯»æ‰¾ä¼˜åŠ¿",
            "questions": ["æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ", "æœ€å¥½çš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ", "æœºä¼šåœ¨å“ªé‡Œï¼Ÿ"]
        },
        "ç»¿å¸½": {
            "emoji": "ğŸ’š",
            "focus": "åˆ›æ„åˆ›æ–°",
            "description": "å…³æ³¨æ–°æƒ³æ³•ã€æ›¿ä»£æ–¹æ¡ˆå’Œåˆ›é€ æ€§æ€ç»´ï¼Œæ‰“ç ´å¸¸è§„",
            "questions": ["è¿˜æœ‰ä»€ä¹ˆå¯èƒ½ï¼Ÿ", "æœ‰æ²¡æœ‰æ›¿ä»£æ–¹æ¡ˆï¼Ÿ", "å¦‚ä½•åˆ›æ–°ï¼Ÿ"]
        },
        "è“å¸½": {
            "emoji": "ğŸ’™",
            "focus": "è¿‡ç¨‹æ§åˆ¶",
            "description": "å…³æ³¨æ€ç»´è¿‡ç¨‹ã€æ€»ç»“å’Œä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼ŒåƒæŒ‡æŒ¥å®˜ä¸€æ ·",
            "questions": ["æˆ‘ä»¬ç°åœ¨åœ¨å“ªï¼Ÿ", "ä¸‹ä¸€æ­¥åšä»€ä¹ˆï¼Ÿ", "å¦‚ä½•æ€»ç»“ï¼Ÿ"]
        }
    }
    
    hat_name = random.choice(list(hats.keys()))
    hat_info = hats[hat_name]
    
    return {
        "technique": "å…­é¡¶æ€è€ƒå¸½",
        "description": "å¹³è¡Œæ€ç»´å·¥å…·ï¼Œè®©ä½ ä»ç‰¹å®šè§’åº¦æ·±å…¥æ€è€ƒ",
        "topic": topic,
        "hat": hat_name,
        "emoji": hat_info["emoji"],
        "focus": hat_info["focus"],
        "hat_description": hat_info["description"],
        "guiding_questions": hat_info["questions"],
        "instruction": f"è¯·æˆ´ä¸Š {hat_info['emoji']} {hat_name}ï¼ˆ{hat_info['focus']}æ€ç»´ï¼‰ï¼Œ"
                      f"é’ˆå¯¹ä¸»é¢˜ã€Œ{topic}ã€è¿›è¡Œæ€è€ƒã€‚\n"
                      f"{hat_info['description']}\n"
                      f"æ€è€ƒé—®é¢˜ï¼š{', '.join(hat_info['questions'])}"
    }


def apply_random_stimulus(topic: str) -> Dict[str, Any]:
    """åº”ç”¨éšæœºåˆºæ¿€æ³•ï¼Œç”¨éšæœºæ¦‚å¿µæ¿€å‘è”æƒ³ã€‚
    
    éšæœºåˆºæ¿€æ³•é€šè¿‡å¼•å…¥çœ‹ä¼¼æ— å…³çš„éšæœºå…ƒç´ ï¼Œ
    å¼ºè¿«å¤§è„‘å»ºç«‹æ–°çš„è”ç³»ï¼Œçªç ´æ€ç»´å®šåŠ¿ã€‚
    
    Args:
        topic: è®¨è®ºä¸»é¢˜
        
    Returns:
        dict: éšæœºåˆºæ¿€è¯å’Œè”æƒ³æç¤º
    """
    stimuli = [
        ("æ°´æµ", "æµåŠ¨ã€é€‚åº”ã€æ±‡èšã€ä¾µèš€ã€å¾ªç¯"),
        ("èœ‚å·¢", "åä½œã€å…­è¾¹å½¢ã€èœ‚èœœã€åˆ†å·¥ã€æ•ˆç‡"),
        ("é•œå­", "åå°„ã€å¯¹ç§°ã€è‡ªæˆ‘è®¤çŸ¥ã€å¤åˆ¶ã€çœŸç›¸"),
        ("äº‘æœµ", "å˜åŒ–ã€æ¼‚æµ®ã€èšæ•£ã€å¤©æ°”ã€æƒ³è±¡"),
        ("æ ‘æ ¹", "éšè—ã€åŸºç¡€ã€ç½‘ç»œã€å¸æ”¶ã€ç¨³å›º"),
        ("è´è¶æ•ˆåº”", "è¿é”ååº”ã€å°å˜åŒ–å¤§å½±å“ã€ä¸å¯é¢„æµ‹"),
        ("æ²™æ¼", "æ—¶é—´ã€æµé€ã€ç¿»è½¬ã€é™åˆ¶ã€èŠ‚å¥"),
        ("å›å£°", "åé¦ˆã€å»¶è¿Ÿã€é‡å¤ã€å…±é¸£ã€ç©ºé—´"),
        ("æŒ‡çº¹", "ç‹¬ç‰¹ã€èº«ä»½ã€ç—•è¿¹ã€å®‰å…¨ã€ä¸ªæ€§åŒ–"),
        ("è’²å…¬è‹±", "ä¼ æ’­ã€è½»ç›ˆã€ç§å­ã€é£ã€æ‰©æ•£"),
        ("ç£é“", "å¸å¼•ã€æ’æ–¥ã€ææ€§ã€éšå½¢åŠ›é‡ã€èšåˆ"),
        ("å¿ƒè·³", "èŠ‚å¥ã€ç”Ÿå‘½ã€è„‰åŠ¨ã€æ ¸å¿ƒã€æŒç»­"),
        ("èºæ—‹", "å¾ªç¯ä¸Šå‡ã€DNAã€æ¸è¿›ã€ä¼˜é›…ã€è‡ªç„¶"),
        ("å…‰å½±", "å¯¹æ¯”ã€å±‚æ¬¡ã€æ—¶é—´ã€æƒ…ç»ªã€è‰ºæœ¯"),
        ("ç§å­", "æ½œåŠ›ã€ç”Ÿé•¿ã€ä¼‘çœ ã€èµ·ç‚¹ã€è¥å…»"),
        ("æ¡¥æ¢", "è¿æ¥ã€è·¨è¶Šã€æ”¯æ’‘ã€é€šé“ã€ä¸¤ç«¯")
    ]
    
    stimulus, associations = random.choice(stimuli)
    
    return {
        "technique": "éšæœºåˆºæ¿€æ³•",
        "description": "å¼•å…¥éšæœºå…ƒç´ ï¼Œå¼ºè¿«å»ºç«‹æ–°è”ç³»ï¼Œçªç ´æ€ç»´å®šåŠ¿",
        "topic": topic,
        "stimulus": stimulus,
        "stimulus_emoji": "ğŸ²",
        "associations": associations,
        "instruction": f"éšæœºåˆºæ¿€è¯: ğŸ² ã€Œ{stimulus}ã€\n"
                      f"å…³è”ç‰¹æ€§: {associations}\n\n"
                      f"è¯·æ€è€ƒï¼šã€Œ{stimulus}ã€è¿™ä¸ªæ¦‚å¿µèƒ½ç»™ä¸»é¢˜ã€Œ{topic}ã€å¸¦æ¥ä»€ä¹ˆå¯å‘ï¼Ÿ\n"
                      f"å°è¯•å»ºç«‹æ„æƒ³ä¸åˆ°çš„è”ç³»ï¼Œæå‡ºåˆ›æ–°æƒ³æ³•ã€‚"
    }


def apply_reverse_thinking(topic: str, context: str = "") -> Dict[str, Any]:
    """åº”ç”¨é€†å‘æ€ç»´ï¼Œä»åé¢æ€è€ƒé—®é¢˜ã€‚
    
    é€†å‘æ€ç»´é€šè¿‡æ€è€ƒã€Œå¦‚ä½•è®©äº‹æƒ…å¤±è´¥ã€ï¼Œ
    ç„¶ååè½¬è¿™äº›å¤±è´¥å› ç´ æ¥å‘ç°æ–°çš„è§£å†³æ–¹æ¡ˆã€‚
    
    Args:
        topic: è®¨è®ºä¸»é¢˜
        context: å½“å‰è®¨è®ºä¸Šä¸‹æ–‡ï¼ˆå¯é€‰ï¼‰
        
    Returns:
        dict: é€†å‘æ€ç»´çš„å¼•å¯¼æç¤º
    """
    return {
        "technique": "é€†å‘æ€ç»´",
        "description": "ä»åé¢æ€è€ƒé—®é¢˜ï¼ŒæŠŠå¤±è´¥å› ç´ åè½¬ä¸ºæˆåŠŸç­–ç•¥",
        "topic": topic,
        "steps": [
            {
                "step": 1,
                "title": "æ€è€ƒå¤±è´¥",
                "prompt": f"å¦‚æœæˆ‘ä»¬æƒ³è®©ã€Œ{topic}ã€å½»åº•å¤±è´¥ï¼Œåº”è¯¥æ€ä¹ˆåšï¼Ÿåˆ—å‡º 3-5 ä¸ªä¼šå¯¼è‡´å¤±è´¥çš„åšæ³•ã€‚"
            },
            {
                "step": 2,
                "title": "åè½¬ç­–ç•¥",
                "prompt": "æŠŠè¿™äº›ã€Œå¤±è´¥æ–¹æ³•ã€åè¿‡æ¥ï¼Œå®ƒä»¬èƒ½ç»™æˆ‘ä»¬ä»€ä¹ˆå¯å‘ï¼Ÿ"
            },
            {
                "step": 3,
                "title": "æå–åˆ›æ–°",
                "prompt": "åŸºäºåè½¬åçš„å¯å‘ï¼Œæå‡ºä½ çš„åˆ›æ–°å»ºè®®ã€‚"
            }
        ],
        "instruction": f"è¯·è¿ç”¨é€†å‘æ€ç»´åˆ†æä¸»é¢˜ã€Œ{topic}ã€ï¼š\n"
                      f"1ï¸âƒ£ é¦–å…ˆæ€è€ƒï¼šå¦‚æœæƒ³è®©è¿™ä»¶äº‹å¤±è´¥ï¼Œè¯¥æ€ä¹ˆåšï¼Ÿ\n"
                      f"2ï¸âƒ£ ç„¶ååè½¬ï¼šæŠŠå¤±è´¥å› ç´ å˜æˆæˆåŠŸç­–ç•¥\n"
                      f"3ï¸âƒ£ æœ€åæç‚¼ï¼šå¾—å‡ºåˆ›æ–°çš„è§£å†³æ–¹æ¡ˆ"
    }


def get_random_technique(topic: str, context: str = "") -> Dict[str, Any]:
    """éšæœºé€‰æ‹©ä¸€ç§åˆ›æ„æ¿€å‘æŠ€æœ¯å¹¶åº”ç”¨ã€‚
    
    Args:
        topic: è®¨è®ºä¸»é¢˜
        context: å½“å‰è®¨è®ºä¸Šä¸‹æ–‡
        
    Returns:
        dict: éšæœºé€‰ä¸­çš„æŠ€æœ¯ç»“æœ
    """
    techniques = [
        ("scamper", apply_scamper),
        ("six_hats", apply_six_hats),
        ("random_stimulus", apply_random_stimulus),
        ("reverse_thinking", apply_reverse_thinking)
    ]
    
    name, func = random.choice(techniques)
    
    if name in ["scamper", "reverse_thinking"]:
        return func(topic, context)
    else:
        return func(topic)
